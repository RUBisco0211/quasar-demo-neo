import{r as p}from"./index.c3235fd4.js";import{drawGif as u}from"./Utils.486cad15.js";import{d as _}from"./particle.3af7776a.js";import"./index.424da776.js";const C=2,I=1,w=12,D=1;class F{constructor(o){this.loadImageShape=async e=>{var s;if(!this._engine.loadImage)throw new Error(`${_} image shape not initialized`);await this._engine.loadImage({gif:e.gif,name:e.name,replaceColor:(s=e.replaceColor)!=null?s:!1,src:e.src})},this._engine=o}addImage(o){this._engine.images||(this._engine.images=[]),this._engine.images.push(o)}draw(o){const{context:e,radius:s,particle:a,opacity:n}=o,i=a.image,r=i==null?void 0:i.element;if(!!i){if(e.globalAlpha=n,i.gif&&i.gifData)u(o);else if(r){const g=i.ratio,t={x:-s,y:-s},l=s*C;e.drawImage(r,t.x,t.y,l,l/g)}e.globalAlpha=I}}getSidesCount(){return w}async init(o){const e=o.actualOptions;if(!(!e.preload||!this._engine.loadImage))for(const s of e.preload)await this._engine.loadImage(s)}loadShape(o){if(o.shape!=="image"&&o.shape!=="images")return;this._engine.images||(this._engine.images=[]);const e=o.shapeData;if(!e)return;this._engine.images.find(a=>a.name===e.name||a.source===e.src)||this.loadImageShape(e).then(()=>{this.loadShape(o)})}particleInit(o,e){var g;if(e.shape!=="image"&&e.shape!=="images")return;this._engine.images||(this._engine.images=[]);const s=this._engine.images,a=e.shapeData;if(!a)return;const n=e.getFillColor(),i=s.find(t=>t.name===a.name||t.source===a.src);if(!i)return;const r=(g=a.replaceColor)!=null?g:i.replaceColor;if(i.loading){setTimeout(()=>{this.particleInit(o,e)});return}(async()=>{var h,f,d;let t;i.svgData&&n?t=await p(i,a,n,e):t={color:n,data:i,element:i.element,gif:i.gif,gifData:i.gifData,gifLoopCount:i.gifLoopCount,loaded:!0,ratio:a.width&&a.height?a.width/a.height:(h=i.ratio)!=null?h:D,replaceColor:r,source:a.src},t.ratio||(t.ratio=1);const l=(f=a.fill)!=null?f:e.shapeFill,c=(d=a.close)!=null?d:e.shapeClose,m={image:t,fill:l,close:c};e.image=m.image,e.shapeFill=m.fill,e.shapeClose=m.close})()}}export{F as ImageDrawer};
