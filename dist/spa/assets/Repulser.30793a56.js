import{Repulse as _}from"./index.7e2a95de.js";import{E as D}from"./ExternalInteractorBase.0b0fb1e9.js";import{C as x,R as w}from"./Ranges.adf21146.js";import{W as b,O as q,X as S,L as C,a5 as P,q as H,t as V,S as k,Y as W,a1 as F}from"./particle.3af7776a.js";import"./index.424da776.js";const h="repulse",L=0,A=6,I=3,B=2,X=0,Y=0,j=1,E=.5;class U extends D{constructor(c,r){super(r),this._clickRepulse=()=>{var n;const t=this.container,o=t.actualOptions.interactivity.modes.repulse;if(!o)return;const e=(n=t.repulse)!=null?n:{particles:[]};if(e.finish||(e.count||(e.count=0),e.count++,e.count===t.particles.count&&(e.finish=!0)),e.clicking){const i=t.retina.repulseModeDistance;if(!i||i<L)return;const u=Math.pow(i/A,I),s=t.interactivity.mouse.clickPosition;if(s===void 0)return;const a=new x(s.x,s.y,u),p=t.particles.quadTree.query(a,l=>this.isEnabled(l));for(const l of p){const{dx:d,dy:m,distance:f}=b(s,l.position),y=f**B,v=o.speed,M=-u*v/y;if(y<=u){e.particles.push(l);const g=q.create(d,m);g.length=M,l.velocity.setTo(g)}}}else if(e.clicking===!1){for(const i of e.particles)i.velocity.setTo(i.initialVelocity);e.particles=[]}},this._hoverRepulse=()=>{const t=this.container,o=t.interactivity.mouse.position,e=t.retina.repulseModeDistance;!e||e<X||!o||this._processRepulse(o,e,new x(o.x,o.y,e))},this._processRepulse=(t,o,e,n)=>{var y;const i=this.container,u=i.particles.quadTree.query(e,v=>this.isEnabled(v)),s=i.actualOptions.interactivity.modes.repulse;if(!s)return;const{easing:a,speed:p,factor:l,maxSpeed:d}=s,m=S(a),f=((y=n==null?void 0:n.speed)!=null?y:p)*l;for(const v of u){const{dx:M,dy:g,distance:R}=b(v.position,t),O=C(m(j-R/o)*f,Y,d),T=q.create(R?M/R*O:f,R?g/R*O:f);v.position.addTo(T)}},this._singleSelectorRepulse=(t,o)=>{const e=this.container,n=e.actualOptions.interactivity.modes.repulse;if(!n)return;const i=document.querySelectorAll(t);!i.length||i.forEach(u=>{const s=u,a=e.retina.pixelRatio,p={x:(s.offsetLeft+s.offsetWidth*E)*a,y:(s.offsetTop+s.offsetHeight*E)*a},l=s.offsetWidth*E*a,d=o.type==="circle"?new x(p.x,p.y,l):new w(s.offsetLeft*a,s.offsetTop*a,s.offsetWidth*a,s.offsetHeight*a),m=n.divs,f=P(m,s);this._processRepulse(p,l,d,f)})},this._engine=c,r.repulse||(r.repulse={particles:[]}),this.handleClickMode=t=>{const o=this.container.actualOptions,e=o.interactivity.modes.repulse;if(!e||t!==h)return;r.repulse||(r.repulse={particles:[]});const n=r.repulse;n.clicking=!0,n.count=0;for(const i of r.repulse.particles)!this.isEnabled(i)||i.velocity.setTo(i.initialVelocity);n.particles=[],n.finish=!1,setTimeout(()=>{r.destroyed||(n.clicking=!1)},e.duration*H)}}clear(){}init(){const c=this.container,r=c.actualOptions.interactivity.modes.repulse;!r||(c.retina.repulseModeDistance=r.distance*c.retina.pixelRatio)}interact(){const c=this.container,r=c.actualOptions,t=c.interactivity.status===V,o=r.interactivity.events,e=o.onHover,n=e.enable,i=e.mode,u=o.onClick,s=u.enable,a=u.mode,p=o.onDiv;t&&n&&k(h,i)?this._hoverRepulse():s&&k(h,a)?this._clickRepulse():W(h,p,(l,d)=>this._singleSelectorRepulse(l,d))}isEnabled(c){var l;const r=this.container,t=r.actualOptions,o=r.interactivity.mouse,e=((l=c==null?void 0:c.interactivity)!=null?l:t.interactivity).events,n=e.onDiv,i=e.onHover,u=e.onClick,s=F(h,n);if(!(s||i.enable&&!!o.position||u.enable&&o.clickPosition))return!1;const a=i.mode,p=u.mode;return k(h,a)||k(h,p)||s}loadModeOptions(c,...r){c.repulse||(c.repulse=new _);for(const t of r)c.repulse.load(t==null?void 0:t.repulse)}reset(){}}export{U as Repulser};
