import{Bubble as D}from"./index.d8d582e8.js";import{L as E,K as R,q,a2 as O,t as T,C as j,Q as H,r as P,a3 as B,a4 as w,a5 as L,S as C,Y as W,a1 as A}from"./particle.24068059.js";import{E as F}from"./ExternalInteractorBase.0b0fb1e9.js";import{C as I,R as K}from"./Ranges.c1fe1e88.js";import"./index.93b2c2bb.js";import"./OptionsColor.75eea803.js";function k(m,i,e,n){if(i>=e){const o=m+(i-e)*n;return E(o,m,i)}else if(i<e){const o=m-(e-i)*n;return E(o,i,m)}}const v="bubble",g=0,Q=0,Y=2,x=1,S=1,G=0,J=0,z=.5,M=1;class ee extends F{constructor(i){super(i),this._clickBubble=()=>{var b,c,f;const e=this.container,n=e.actualOptions,o=e.interactivity.mouse.clickPosition,s=n.interactivity.modes.bubble;if(!s||!o)return;e.bubble||(e.bubble={});const t=e.retina.bubbleModeDistance;if(!t||t<g)return;const l=e.particles.quadTree.queryCircle(o,t,u=>this.isEnabled(u)),{bubble:a}=e;for(const u of l){if(!a.clicking)continue;u.bubble.inRange=!a.durationEnd;const p=u.getPosition(),d=R(p,o),r=(new Date().getTime()-((b=e.interactivity.mouse.clickTime)!=null?b:Q))/q;r>s.duration&&(a.durationEnd=!0),r>s.duration*Y&&(a.clicking=!1,a.durationEnd=!1);const h={bubbleObj:{optValue:e.retina.bubbleModeSize,value:u.bubble.radius},particlesObj:{optValue:O(u.options.size.value)*e.retina.pixelRatio,value:u.size.value},type:"size"};this._process(u,d,r,h);const y={bubbleObj:{optValue:s.opacity,value:u.bubble.opacity},particlesObj:{optValue:O(u.options.opacity.value),value:(f=(c=u.opacity)==null?void 0:c.value)!=null?f:x},type:"opacity"};this._process(u,d,r,y),!a.durationEnd&&d<=t?this._hoverBubbleColor(u,d):delete u.bubble.color}},this._hoverBubble=()=>{const e=this.container,n=e.interactivity.mouse.position,o=e.retina.bubbleModeDistance;if(!o||o<g||!n)return;const s=e.particles.quadTree.queryCircle(n,o,t=>this.isEnabled(t));for(const t of s){t.bubble.inRange=!0;const l=t.getPosition(),a=R(l,n),b=S-a/o;a<=o?b>=J&&e.interactivity.status===T&&(this._hoverBubbleSize(t,b),this._hoverBubbleOpacity(t,b),this._hoverBubbleColor(t,b)):this.reset(t),e.interactivity.status===j&&this.reset(t)}},this._hoverBubbleColor=(e,n,o)=>{const s=this.container.actualOptions,t=o!=null?o:s.interactivity.modes.bubble;if(!!t){if(!e.bubble.finalColor){const l=t.color;if(!l)return;const a=H(l);e.bubble.finalColor=P(a)}if(!!e.bubble.finalColor)if(t.mix){e.bubble.color=void 0;const l=e.getFillColor();e.bubble.color=l?B(w(l,e.bubble.finalColor,S-n,n)):e.bubble.finalColor}else e.bubble.color=e.bubble.finalColor}},this._hoverBubbleOpacity=(e,n,o)=>{var f,u,p,d;const s=this.container,t=s.actualOptions,l=(u=o==null?void 0:o.opacity)!=null?u:(f=t.interactivity.modes.bubble)==null?void 0:f.opacity;if(!l)return;const a=e.options.opacity.value,b=(d=(p=e.opacity)==null?void 0:p.value)!=null?d:x,c=k(b,l,O(a),n);c!==void 0&&(e.bubble.opacity=c)},this._hoverBubbleSize=(e,n,o)=>{const s=this.container,t=o!=null&&o.size?o.size*s.retina.pixelRatio:s.retina.bubbleModeSize;if(t===void 0)return;const l=O(e.options.size.value)*s.retina.pixelRatio,a=e.size.value,b=k(a,t,l,n);b!==void 0&&(e.bubble.radius=b)},this._process=(e,n,o,s)=>{var h;const t=this.container,l=s.bubbleObj.optValue,a=t.actualOptions,b=a.interactivity.modes.bubble;if(!b||l===void 0)return;const c=b.duration,f=t.retina.bubbleModeDistance,u=s.particlesObj.optValue,p=s.bubbleObj.value,d=(h=s.particlesObj.value)!=null?h:G,r=s.type;if(!(!f||f<g||l===u))if(t.bubble||(t.bubble={}),t.bubble.durationEnd)p&&(r==="size"&&delete e.bubble.radius,r==="opacity"&&delete e.bubble.opacity);else if(n<=f){if((p!=null?p:d)!==l){const _=d-o*(d-l)/c;r==="size"&&(e.bubble.radius=_),r==="opacity"&&(e.bubble.opacity=_)}}else r==="size"&&delete e.bubble.radius,r==="opacity"&&delete e.bubble.opacity},this._singleSelectorHover=(e,n,o)=>{const s=this.container,t=document.querySelectorAll(n),l=s.actualOptions.interactivity.modes.bubble;!l||!t.length||t.forEach(a=>{const b=a,c=s.retina.pixelRatio,f={x:(b.offsetLeft+b.offsetWidth*z)*c,y:(b.offsetTop+b.offsetHeight*z)*c},u=b.offsetWidth*z*c,p=o.type==="circle"?new I(f.x,f.y,u):new K(b.offsetLeft*c,b.offsetTop*c,b.offsetWidth*c,b.offsetHeight*c),d=s.particles.quadTree.query(p,r=>this.isEnabled(r));for(const r of d){if(!p.contains(r.getPosition()))continue;r.bubble.inRange=!0;const h=l.divs,y=L(h,b);(!r.bubble.div||r.bubble.div!==b)&&(this.clear(r,e,!0),r.bubble.div=b),this._hoverBubbleSize(r,M,y),this._hoverBubbleOpacity(r,M,y),this._hoverBubbleColor(r,M,y)}})},i.bubble||(i.bubble={}),this.handleClickMode=e=>{e===v&&(i.bubble||(i.bubble={}),i.bubble.clicking=!0)}}clear(i,e,n){i.bubble.inRange&&!n||(delete i.bubble.div,delete i.bubble.opacity,delete i.bubble.radius,delete i.bubble.color)}init(){const i=this.container,e=i.actualOptions.interactivity.modes.bubble;!e||(i.retina.bubbleModeDistance=e.distance*i.retina.pixelRatio,e.size!==void 0&&(i.retina.bubbleModeSize=e.size*i.retina.pixelRatio))}interact(i){const e=this.container.actualOptions,n=e.interactivity.events,o=n.onHover,s=n.onClick,t=o.enable,l=o.mode,a=s.enable,b=s.mode,c=n.onDiv;t&&C(v,l)?this._hoverBubble():a&&C(v,b)?this._clickBubble():W(v,c,(f,u)=>this._singleSelectorHover(i,f,u))}isEnabled(i){var c;const e=this.container,n=e.actualOptions,o=e.interactivity.mouse,s=((c=i==null?void 0:i.interactivity)!=null?c:n.interactivity).events,{onClick:t,onDiv:l,onHover:a}=s,b=A(v,l);return b||a.enable&&!!o.position||t.enable&&o.clickPosition?C(v,a.mode)||C(v,t.mode)||b:!1}loadModeOptions(i,...e){i.bubble||(i.bubble=new D);for(const n of e)i.bubble.load(n==null?void 0:n.bubble)}reset(i){i.bubble.inRange=!1}}export{ee as Bubbler};
