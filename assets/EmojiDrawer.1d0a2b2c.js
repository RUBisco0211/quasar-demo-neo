import{v as h}from"./index.52138c9a.js";import{S as D,a9 as x,e as v,Q as S,a2 as g}from"./particle.3af7776a.js";import"./index.424da776.js";function y(d){const{context:o,particle:e,radius:n,opacity:i}=d,t=e.emojiData,r=2,c=n*r,m=o.globalAlpha;!t||(o.globalAlpha=i,o.drawImage(t,-n,-n,c,c),o.globalAlpha=m)}const j='"Twemoji Mozilla", Apple Color Emoji, "Segoe UI Emoji", "Noto Color Emoji", "EmojiOne Color"';class O{constructor(){this._emojiShapeDict=new Map}destroy(){for(const[o,e]of this._emojiShapeDict)e instanceof ImageBitmap&&(e==null||e.close(),this._emojiShapeDict.delete(o))}draw(o){y(o)}async init(o){const e=o.actualOptions;if(!h.find(t=>D(t,e.particles.shape.type)))return;const n=[x(j)],i=h.map(t=>e.particles.shape.options[t]).find(t=>!!t);i&&v(i,t=>{t.font&&n.push(x(t.font))}),await Promise.all(n)}particleDestroy(o){delete o.emojiData}particleInit(o,e){var u;const i=e.shapeData;if(!(i!=null&&i.value))return;const t=S(i.value,e.randomIndexData),r=(u=i.font)!=null?u:j;if(!t)return;const c=`${t}_${r}`,m=this._emojiShapeDict.get(c);if(m){e.emojiData=m;return}const p=g(e.size.value)*2;let f;const l=g(e.size.value);if(typeof OffscreenCanvas!="undefined"){const s=new OffscreenCanvas(p,p),a=s.getContext("2d");if(!a)return;a.font=`400 ${l*2}px ${r}`,a.textBaseline="middle",a.textAlign="center",a.fillText(t,l,l),f=s.transferToImageBitmap()}else{const s=document.createElement("canvas");s.width=p,s.height=p;const a=s.getContext("2d");if(!a)return;a.font=`400 ${l*2}px ${r}`,a.textBaseline="middle",a.textAlign="center",a.fillText(t,l,l),f=s}this._emojiShapeDict.set(c,f),e.emojiData=f}}export{O as EmojiDrawer};
